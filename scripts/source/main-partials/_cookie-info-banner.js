/**
 * =============================================================================
 * Cookie info banner
 * =============================================================================
 */

const Cookies = require("js-cookie");

/**
 * Configuration:
 * Enter the info text, including a link to your privacy policy.
 * You should move this variable declaration to your HTML document (or extract
 * it from the “data-” attribute of an HTML element) if you want to fill it with
 * information generated by a CMS, e.g. different messages for a multi-language
 * website.
 */
const mvl_cookie_info_banner__text =
  'Cookies help deliver this website. By using this website, you agree to its use of cookies, as detailed in the <a href="/privacy/">privacy policy</a>.';

// Select some DOM elements required to build the cookie info banner
const mvl_page_footer = document.querySelector(".js-page-footer");

// Set a 0px bottom margin for the page footer, which will be altered later on.
let mvl_page_footer__margin_bottom = "0px";

// Create the cookie banner container element.
const mvl_cookie_info_banner = document.createElement("div");

if (Cookies.get("mvl_cookiePermission") !== "ok") {
  // Create the cookie info banner and insert it after the page footer.
  mvl_cookie_info_banner.classList.add("cookie-info-banner");
  mvl_cookie_info_banner.innerHTML = `<div class="wrapper"><div class="cookie-info-banner__box"><p class="cookie-info-banner__message">${mvl_cookie_info_banner__text} <button type="button" class="cookie-info-banner__close-button">OK</button></p></div></div>`;
  mvl_page_footer.parentNode.insertBefore(
    mvl_cookie_info_banner,
    mvl_page_footer.nextSibling
  );

  // Adjust bottom margin of page footer to make room for the cookie input
  // banner. The banner should be sticky but should not overlap the footer
  // when a website visitors scrolls all the way down.
  mvl_page_footer__margin_bottom = `${
    document.querySelector(".cookie-info-banner").offsetHeight
  }px`;
  mvl_page_footer.style.marginBottom = mvl_page_footer__margin_bottom;
}

// Enable the close button of the banner to do its job.
document
  .querySelector(".cookie-info-banner__close-button")
  .addEventListener("click", event => {
    event.preventDefault();
    mvl_page_footer.style.marginBottom = "0px";
    mvl_cookie_info_banner.style.display = "none";
    Cookies.set("mvl_cookiePermission", "ok", {
      expires: 3650,
      path: "/"
    });
  });

// Adjust bottom margin of page footer after windows resize because on
// smaller screens the text of the banner probably is too long for just
// one line which results in an increased height of the banner.
window.addEventListener("resize", () => {
  if (Cookies.get("mvl_cookiePermission") !== "ok") {
    mvl_page_footer__margin_bottom = `${
      document.querySelector(".cookie-info-banner").offsetHeight
    }px`;
    mvl_page_footer.style.marginBottom = mvl_page_footer__margin_bottom;
  }
});
