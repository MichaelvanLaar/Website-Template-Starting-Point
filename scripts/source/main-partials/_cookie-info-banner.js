/**
 * =============================================================================
 * Cookie info banner
 * =============================================================================
 */

// Namespace prefix for variables: “cib”

const Cookies = require("js-cookie");

/**
 * -----------------------------------------------------------------------------
 * Configuration
 * -----------------------------------------------------------------------------
 */

// Enter the info text, including a link to your privacy policy.
// You should move this variable declaration to your HTML document (or extract
// it from the “data-” attribute of an HTML element) if you want to fill it with
// information generated by a CMS, e.g. different messages for a multi-language
// website.
const cibBannerText =
  'Cookies help deliver this website. By using this website, you agree to its use of cookies, as detailed in the <a href="/privacy/">privacy policy</a>.';

const cibBannerClass = "cookie-info-banner";
const cibPageFooterClass = "js-page-footer";
const cibPermissionCookieName = "cib_CookiePermission";

/**
 * -----------------------------------------------------------------------------
 * Main script
 * -----------------------------------------------------------------------------
 */

// Select some DOM elements required to build the cookie info banner
const cibPageFooter = document.querySelector(`.${cibPageFooterClass}`);

// Set a 0px bottom margin for the page footer, which will be altered later on.
let cibPageFooterMarginBottom = "0px";

// Create the cookie banner container element.
const cibElement = document.createElement("div");

if (Cookies.get(cibPermissionCookieName) !== "ok") {
  // Create the cookie info banner and insert it after the page footer.
  cibElement.classList.add(cibBannerClass);
  cibElement.innerHTML = `<div class="wrapper"><div class="${cibBannerClass}__box"><p class="${cibBannerClass}__message"><span class="${cibBannerClass}__message-text">${cibBannerText}</span> <button type="button" class="${cibBannerClass}__close-button">OK</button></p></div></div>`;
  cibPageFooter.parentNode.insertBefore(cibElement, cibPageFooter.nextSibling);

  // Adjust bottom margin of page footer to make room for the cookie input
  // banner. The banner should be sticky but should not overlap the footer
  // when a website visitors scrolls all the way down.
  cibPageFooterMarginBottom = `${
    document.querySelector(`.${cibBannerClass}`).offsetHeight
  }px`;
  cibPageFooter.style.marginBottom = cibPageFooterMarginBottom;

  // Enable the close button of the banner to do its job.
  document
    .querySelector(`.${cibBannerClass}__close-button`)
    .addEventListener("click", event => {
      event.preventDefault();
      cibPageFooter.style.marginBottom = "0px";
      cibElement.style.display = "none";
      Cookies.set(cibPermissionCookieName, "ok", {
        expires: 3650,
        path: "/"
      });
    });
}

// Adjust bottom margin of page footer after windows resize because on
// smaller screens the text of the banner probably is too long for just
// one line which results in an increased height of the banner.
window.addEventListener("resize", () => {
  if (Cookies.get(cibPermissionCookieName) !== "ok") {
    cibPageFooterMarginBottom = `${
      document.querySelector(`.${cibBannerClass}`).offsetHeight
    }px`;
    cibPageFooter.style.marginBottom = cibPageFooterMarginBottom;
  }
});
